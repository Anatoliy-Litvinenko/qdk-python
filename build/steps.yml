# Add conda to system path
steps:
- script: echo "##vso[task.prependpath]$CONDA/bin"
  displayName: Add conda to PATH

- task: Cache@2
  displayName: Use cached Anaconda environment
  inputs:
    key: 'conda | "$(Agent.OS)" | azure-quantum/environment.yml'
    restoreKeys: | 
      python | "$(Agent.OS)"
      python
    path: $(workingDirectory)
    cacheHitVar: CONDA_CACHE_RESTORED

- script: conda env create --quiet --file azure-quantum/environment.yml
  workingDirectory: $(Build.SourcesDirectory)
  displayName: Create Anaconda environment
  condition: eq(variables.CONDA_CACHE_RESTORED, 'false')

- script: |
    conda create -n test
    conda info --envs
    source activate azurequantum
    pytest azure-quantum
  displayName: Run unit tests
